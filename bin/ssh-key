#!/usr/bin/env bash

source bin/common
source bin/colors


CA=files/ssh/ca
KEYS=files/ssh/hosts

host=$1
pubkey=$KEYS/${host}.pub
privkey=$KEYS/${host}

if [ -f "${pubkey}" ]; then
  eche "${bold}${red}====> Key already exists${reset}"
  exit 1
fi

eche "${bold}${blue}====> Generate and sign SSH keyset [${green}${host}${blue}]${reset}"

eche "${bold}${blue}----> Generate private key (${green}${privkey}${blue})${reset}"
if ! ssh-keygen -t rsa -b 4096 -N '' -C "${host}" -f "${privkey}"; then
  eche "${bold}${red}===> Key generation failed${reset}"
  exit 1
fi

eche "${bold}${green}====> Keyset created${reset}"
