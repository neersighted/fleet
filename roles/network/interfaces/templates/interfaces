auto lo

iface lo inet loopback


auto eth0

{% for ip in network.ipv4.public %}
iface eth0 inet static
{% if loop.first %}
  gateway {{ network.ipv4.gateway }}
{% endif %}
  address {{ ip }}
  netmask {{ network.ipv4.netmask }}
{% if loop.first %}
  up /sbin/tc qdisc add dev $IFACE root handle 1: htb default f r2q 250
  up /sbin/tc class add dev $IFACE parent 1: classid 1:1 htb rate {{ network.speed }}
  up /sbin/tc class add dev $IFACE parent 1:1 classid 1:f htb rate {{ network.speed }}
  up /sbin/tc qdisc add dev $IFACE parent 1:f handle f: sfq
  down /sbin/tc qdisc del dev $IFACE root
{% endif %}
{% endfor %}

{% for ip in network.ipv6.public %}
iface eth0 inet6 static
{% if loop.first %}
  gateway {{ network.ipv6.gateway }}
{% endif %}
  address {{ ip }}
  netmask {{ network.ipv6.netmask }}
{% if not loop.first %}
  post-up ip addr change {{ ip }}/{{ network.ipv6.netmask }} preferred_lft 0 dev eth0
{% endif %}
{% endfor %}
