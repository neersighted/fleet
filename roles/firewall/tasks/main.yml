- name: install ufw (apt)
  apt: pkg=ufw state=latest
  when: ansible_pkg_mgr == 'apt'

- name: enable ipv6
  lineinfile: >
    dest=/etc/default/ufw
    state=present
    regexp='^IPV6'
    line='IPV6=yes'
  notify: reload firewall

- name: configure rules
  with_dict: firewall
  action: ufw
  args: item.value
  notify: reload firewall

- name: configure default incoming rule
  ufw: default={{ firewall_default_in}} direction=incoming
  notify: reload firewall

- name: configure default outgoing rule
  ufw: default={{ firewall_default_out}} direction=outgoing
  notify: reload firewall

- name: ufw | enable ufw
  ufw: state=enabled
