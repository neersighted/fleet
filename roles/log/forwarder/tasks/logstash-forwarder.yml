- name: logstash-forwarder | add logstash-forwarder repo key (apt)
  apt_key: id=D88E42B4 url=http://packages.elasticsearch.org/GPG-KEY-elasticsearch state=present
  when: ansible_pkg_mgr == 'apt'

- name: logstash-forwarder | add logstash-forwarder repo (apt)
  apt_repository: repo='deb http://packages.elasticsearch.org/logstashforwarder/debian stable main' state=present
  when: ansible_pkg_mgr == 'apt'

- name: logstash-forwarder | install logstash-forwarder (apt)
  apt: pkg=logstash-forwarder state=latest
  when: ansible_pkg_mgr == 'apt'

- name: logstash-forwarder | transfer logstash-forwarder keys
  copy: src=files/log/logstash.crt dest=/etc/logstash-forwarder.crt

- name: logstash-forwarder | configure logstash-forwarder
  template: src=logstash-forwarder.conf dest=/etc/logstash-forwarder
  notify: restart logstash-forwarder

- name: logstash-forwarder | install logstash-forwarder init script
  copy: src=logstash-forwarder.init dest=/etc/init.d/logstash-forwarder

- name: logstash-forwarder | enable and start logstash-forwarder
  service: name=logstash-forwarder state=started enabled=yes
