filter {
  if [type] == "nginx-access" {
    grok {
      match => [ "message", "%{IPORHOST:nginx_ip} - %{NGINXUSER:nginx_user} \[%{HTTPDATE:timestamp}\] \"%{WORD:nginx_action} %{URIPATHPARAM:nginx_uri} HTTP/%{NUMBER:nginx_protocol}\" %{NUMBER:nginx_response} %{NUMBER:nginx_length} %{QS:nginx_referrer} %{QS:nginx_useragent}" ]
    }


    geoip {
      source => "nginx_ip"
    }
    useragent {
      source => "nginx_useragent"
    }


    date {
      match => [ "timestamp" , "dd/MMM/YYYY:HH:mm:ss Z" ]
      remove_field => [ "timestamp" ]
    }
  }
}
