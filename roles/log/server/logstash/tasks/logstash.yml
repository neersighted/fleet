- name: logstash | add logstash repo key (apt)
  apt_key: id=D88E42B4 url=http://packages.elasticsearch.org/GPG-KEY-elasticsearch state=present
  when: ansible_pkg_mgr == 'apt'

- name: logstash | add logstash repo (apt)
  apt_repository: repo='deb http://packages.elasticsearch.org/logstash/1.4/debian stable main' state=present
  when: ansible_pkg_mgr == 'apt'

- name: logstash | install logstash (apt)
  apt: pkg=logstash state=latest
  when: ansible_pkg_mgr == 'apt'

- name: logstash | transfer logstash keys
  with_items:
    - files/log/logstash.crt
    - files/log/logstash.key
  copy: src={{ item }} dest=/etc/logstash/{{ item|basename }}

- name: logstash | configure logstash
  copy: src=conf.d/ dest=/etc/logstash/conf.d/
  notify: restart logstash

- name: logstash | enable and start logstash
  service: name=logstash state=started enabled=yes
