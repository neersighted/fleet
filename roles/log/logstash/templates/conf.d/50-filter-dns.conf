filter {
  if [type] == "dns" {
    mutate {
      # Rename fields to something more inline with the rest of our processing.
      rename => [
        "qname", "dns_query",
        "qclass", "dns_class",
        "qtype", "dns_type",
        "answer", "dns_response",
        "ttl", "dns_ttl",
        "rrprint", "dns_resourcerecord",
        "rcode", "dns_status",
        "error", "dns_error",
        "ipv6", "dns_ipv6",
        "tld", "dns_tld",
        "s_addr", "dns_src_ip",
        "d_addr", "dns_dest_ip",
        "nsid", "dns_host"
      ]
      # Drop 'n'.
      remove_field => ["n"]
    }
    mutate {
      # Set status to NOERROR if it's not set.
      add_field => [ "dns_status", "NOERROR"]
    }
    # Set the source and create a message.
    mutate {
      add_field => [ "message", "%{dns_src_ip} %{dns_query} %{dns_ttl} %{dns_class} %{dns_type} %{dns_response} %{dns_status}" ]
      replace => [ "host", "%{nsid}" ]
    }


    geoip {
      source => "dns_src_ip"
    }

    date {
      match => [ "timestamp", "TAI64N" ]
      remove_field => [ "timestamp" ]
    }
  }
}
