filter {
  if [type] == "dns" {
    # Set the message source.
    mutate {
      replace => [ "host", "%{nsid}" ]
    }

    # Rename fields and drop 'n'.
    mutate {
      rename => [
        "qname", "dns_name",
        "ttl", "dns_ttl",
        "qclass", "dns_class",
        "qtype", "dns_type",
        "answer", "dns_response",
        "rrprint", "dns_resourcerecord",
        "rcode", "dns_status",
        "error", "dns_error",
        "ipv6", "dns_ipv6",
        "tld", "dns_tld",
        "s_addr", "dns_src_ip",
        "d_addr", "dns_dest_ip",
        "nsid", "dns_host"
      ]
      remove_field => ["n"]
    }

    geoip {
      source => "dns_src_ip"
    }

    date {
      match => [ "timestamp", "TAI64N" ]
      remove_field => [ "timestamp" ]
    }
  }
}
