filter {
  if [type] == "dns" {
    mutate {
      # Rename fields to something more inline with the rest of our processing.
      rename => {
        "qname"  => "query"
        "qclass" => "class"
        "qtype"  => "type"
        "ttl"    => "ttl"
        "answer" => "result"
        "rcode"  => "status"
        "s_addr" => "src_ip"
        "d_addr" => "dst_ip"
        "nsid"   => "host"
      }
      # Built a full request (and set status if unset).
      add_field => {
        "request"  => "%{query} %{class} %{type} @%{dst_ip}"
        "response" => "%{query} %{class} %{type} %{ttl} %{result}"
        "status"   => "NOERROR"
      }
      # Drop some unwanted stuff.
      remove_field => [
        "rrprint",
        "error",
        "ipv6",
        "tld",
        "n"
      ]
    }
    mutate {
      add_field => [
        "message", "%{response} %{status}"
      ]
    }


    # Run geoip lookups.
    geoip {
      source => "src_ip"
    }

    date {
      match        => [ "timestamp", "TAI64N" ]
      remove_field => [ "timestamp" ]
    }
  }
}
